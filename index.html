<!DOCTYPE html>             
<html lang="en-us">
    <head>
        <meta charset="utf-8">
        <title>D3 GDP</title>
        <script src="https://d3js.org/d3.v5.min.js"></script>  
        <link rel="stylesheet" type='text/css' href='style.css'> 
        <script>   
            async function getDataThenRunPage() {
                const gdpData = await fetch("https://raw.githubusercontent.com/freeCodeCamp/ProjectReferenceData/master/GDP-data.json")
                .then(res => res.json())
                .catch(err => console.log(err))

                const svgWidth = 1000;
                const svgHeight = 600;
                const padding = 100;
            
                const svg = d3.select('h1')
                .append('svg')
                .attr('width', svgWidth)
                .attr('height', svgHeight)
                .attr('id', 'title')
                .style('background-color', 'white')

                const xScale = d3.scaleLinear()
                .domain( [1947, 2015.75] )
                .range( [padding, svgWidth - padding] )
                
                const yScale = d3.scaleLinear()
                .domain([0, d3.max(gdpData.data, (d) => d[1])])
                .range([svgHeight -padding, padding])

                svg.selectAll('rect')
                .data(gdpData.data)
                .enter()
                .append('rect')
                .attr('x', (d, i) => {
                    const getYearRegex = /[0-9]{4}/;
                    const getMonthWithHyphenRegex = /-[0-9]{2}/;
                    const getMonthRegex = /[0-9]{2}/;
                    const year = Number(d[0].match(getYearRegex));
                    const hyphenMonth = d[0].match(getMonthWithHyphenRegex);
                    const month = Number(hyphenMonth[0].match(getMonthRegex));

                    if(month === 1) {
                        return xScale(year)
                    }
                    if(month === 4) {
                        return xScale(year + .25)
                    }
                    if(month === 7) {
                        return xScale(year + .50)
                    }
                    if(month === 10) {
                        return xScale(year + .75)
                    }
                })
                .attr('y', (d,i) =>  yScale(d[1]) )
                .attr('width', (svgWidth - padding - padding) / gdpData.data.length )
                .attr('height', (d) => svgHeight - yScale(d[1]) - padding)
                .attr('fill', 'green')
                .attr('class', 'bar')
                .attr('data-date', (d) => d[0])
                .attr('data-gdp', (d) => d[1])
                .on('mouseover', (d) => {
                    console.log('mousover works',d)
                    let gdpInfo = d;
                    toolTip
                    .data(gdpInfo)
                    .attr('data-date', (gdpInfo) => d[0])
                    .attr('data-gdp', (gdpInfo) => d[1])
                    .attr('x', (gdpInfo) => {
                        console.log('attr d inside tooltip', d)
                        console.log(event.pageX, "page x???")
                        return event.pageX
                    })
                    .attr('y', svgHeight - padding - 100)
                    .attr('opacity', 1)
                    //.text(d)
                })
                 .on('mouseout', (d) => {
                //     let gdpInfo = d;
                     toolTip
                //     .data(gdpInfo)
                //     .attr('data-date', (d) => d[0])
                //     .attr('data-gdp', (d) => d[1])
                //     .attr('x', (d) => {
                //         console.log('attr d inside tooltip', d)
                //         console.log(event.pageX, "page x???")
                //         return event.pageX
                //     })
                //     .attr('y', svgHeight - padding - 100)
                     .attr('opacity', 0)
                //     //.text(d)
                 })
                
                
                const toolTip = 
                svg.append('rect')
                .attr("id", 'tooltip')
                .attr('width', 70)
                .attr('height', 50)
                .attr('fill', 'lightblue')
                .attr("opacity", 0)
                

     
                // .attr('y', svgHeight - padding - 100)
                // .on('mouseover', function(d) {
                //     console.log('mousover works')
                //     return style("opacity", 1);
                // })
                // // .on('mousemove', function() {
                // //     return toolTips.style("top", (event.pageY-800)+"px").style("left",(event.pageX-800)+"px");
                // // })
                // .on("mouseout", function(d){return style("opacity", 0);});

                //d3.select("#tooltip")
                
                //.attr('r', 20)
                //.text('tooltip here')
                
                //make new tooltip
                //use x y scale
                // add mouseover etc

                

                let xAxis = d3.axisBottom(xScale).tickFormat(d3.format("d"))
    
                svg.append("g")
                .attr("transform", `translate(0, ${ svgHeight - padding })`)
                .call(xAxis)
                .attr('id', 'x-axis')
                .attr('class', 'tick')


                const yAxis = d3.axisLeft(yScale);

                svg.append("g")
                .attr('transform', `translate( ${padding}, 0)`)
                .call(yAxis)
                .attr('id', 'y-axis')
                .attr('class', 'tick')
            }
            getDataThenRunPage();
            
        </script>
        
    </head>
    
    <body>
        <h1>United States GDP</h1>
        
    </body>
    <script src="https://cdn.freecodecamp.org/testable-projects-fcc/v1/bundle.js"></script>
</html>
