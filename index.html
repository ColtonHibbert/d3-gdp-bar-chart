<!DOCTYPE html>             
<html lang="en-us">
    <head>
        <meta charset="utf-8">
        <title>D3 GDP</title>
        <script src="https://d3js.org/d3.v5.min.js"></script>  
        <link rel="stylesheet" type='text/css' href='style.css'> 
        <script>   
            async function getDataThenRunPage() {
                const gdpData = await fetch("https://raw.githubusercontent.com/freeCodeCamp/ProjectReferenceData/master/GDP-data.json")
                .then(res => res.json())
                .catch(err => console.log(err))

                const svgWidth = 1000;
                const svgHeight = 600;
                const padding = 100;
            
                const svg = d3.select('div')
                .append('svg')
                .attr('width', svgWidth)
                .attr('height', svgHeight)
                .attr('id', 'title')
                .style('background-color', 'white')
                
                //domain x 1947 and max 2015 of july or 2015.75

                //how to scale on x, and get periods with dates
                // can use the quarters
                // can build a dates array with quarters
                // need to be numeric, 1947, then .25 .50 .75
                // can make a scale on that
                //console.log(Date.parse("1947-01-01"))
                // other option is to convert to milliseconds with date.parse()
                
                // console.log(gdpData.data[gdpData.data.length - 1][0])
                // const xScale = d3.scaleLinear()
                // .domain( [Date.parse(gdpData.data[0][0]), Date.parse(gdpData.data[gdpData.data.length -1 ][0])] )
                // .range( [padding, svgWidth - padding] )
                // //console.log(Date.parse(gdpData.data[0][0]), Date.parse(gdpData.data[gdpData.data.length -1][0]))
                // //console.log('max y',d3.max(gdpData.data, (d) => d[1]))
                // console.log(gdpData.data[0][0]);
                // console.log(xScale( Date.parse(gdpData.data[0][0])) ) ;

                // const yScale = d3.scaleLinear()
                // .domain([0, d3.max(gdpData.data, (d) => d[1])])
                // .range([0 , svgHeight - padding])
                // //console.log(yScale(243.1))

                // svg.selectAll('rect')
                // .data(gdpData.data)
                // .enter()
                // .append('rect')
                // .attr('x', (d, i) => xScale(Date.parse(d[0])) )
                // .attr('y', (d,i) => svgHeight - yScale(d[1]) - padding )
                // .attr('width', (svgWidth - padding - padding) / gdpData.data.length )
                // .attr('height', (d) => yScale(d[1]))
                // .attr('fill', 'green')

                // const xAxis = d3.axisBottom(xScale);
                // svg.append("g")
                // .attr("transform", `translate(0, ${ svgHeight - padding })`)
                // .call(xAxis)


                const xScale = d3.scaleLinear()
                .domain( [1947, 2015.75] )
                .range( [padding, svgWidth - padding] )
                //console.log(xScale( 1947));

                const yScale = d3.scaleLinear()
                .domain([0, d3.max(gdpData.data, (d) => d[1])])
                .range([svgHeight -padding, padding])


                svg.selectAll('rect')
                .data(gdpData.data)
                .enter()
                .append('rect')
                .attr('x', (d, i) => {
                    const getYearRegex = /[0-9]{4}/;
                    const getMonthWithHyphenRegex = /-[0-9]{2}/;
                    const getMonthRegex = /[0-9]{2}/;
                    const year = Number(d[0].match(getYearRegex));
                    const hyphenMonth = d[0].match(getMonthWithHyphenRegex);
                    const month = Number(hyphenMonth[0].match(getMonthRegex));

                    if(month === 1) {
                        return xScale(year)
                    }
                    if(month === 4) {
                        return xScale(year + .25)
                    }
                    if(month === 7) {
                        return xScale(year + .50)
                    }
                    if(month === 10) {
                        return xScale(year + .75)
                    }
                })
                .attr('y', (d,i) =>  yScale(d[1]) )
                .attr('width', (svgWidth - padding - padding) / gdpData.data.length )
                .attr('height', (d) => svgHeight - yScale(d[1]) - padding)
                .attr('fill', 'green')
                .attr('class', 'bar')

                let xAxis = d3.axisBottom(xScale).tickValues(['1950', '1955', '1960', '1965', '1970', '1975', '1980', '1985', '1990', '1995', '2000', '2005', '2010', '2015']);
                svg.append("g")
                .attr("transform", `translate(0, ${ svgHeight - padding })`)
                .call(xAxis)
                .attr('id', 'x-axis')
                .attr('class', 'tick')
                


                const yAxis = d3.axisLeft(yScale);
                svg.append("g")
                .attr('transform', `translate( ${padding}, 0)`)
                .call(yAxis)
                .attr('id', 'y-axis')
                .attr('class', 'tick')
            }
            getDataThenRunPage();
            
        </script>
    </head>
    <body>
        <h1>United States GDP</h1>
        <div></div>
    </body>
</html>
